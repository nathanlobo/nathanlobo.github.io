<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GitHub Files - mini-projects</title>
  <style>
              :root {
  --bg: #0d1117;
  --panel: #0d1117;
  --muted: #8b949e;
  --border: #30363d;
  --accent: #58a6ff;
  --text: #c9d1d9;
}
:root.light {
  --bg: #ffffff;
  --panel: #f6f8fa;
  --muted: #57606a;
  --border: #d0d7de;
  --accent: #0969da;
  --text: #24292f;
}
body { background: var(--bg); color: var(--text); }
.topbar {
  display:flex; align-items:center;
  padding:12px 16px; border-bottom:1px solid var(--border);
  background:var(--panel);
}
.btn {
  background:transparent; border:1px solid transparent;
  color:var(--muted); padding:6px 10px;
  border-radius:6px; cursor:pointer; font-weight:700;
}
.btn:hover { color:var(--accent); background:rgba(88,166,255,0.06); }
              
  body { font-family: Arial, sans-serif; background: var(--bg); color: var(--text); padding:20px; }
  .link-container { display:flex; flex-direction:column; gap:15px; max-width:900px; margin:auto; margin-top:32px; }
    .link-block { background:#161d80; color:white; padding:12px 16px; border-radius:8px;
                  display:flex; align-items:center; justify-content:space-between; gap:16px; }
    .link-info { display:flex; flex-direction:column; gap:4px; overflow:hidden; max-width:70%; }
    .link-title { font-weight:700; font-size:15px; }
    .link-url { font-size:13px; color:rgba(255,255,255,0.95); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; display:inline-block; max-width:100%; }
    .button-container { display:flex; gap:8px; }
    .btn { padding:8px 12px; border-radius:5px; border:none; cursor:pointer; font-weight:700; }
    .btn-view { background:#0b66ff; color:white; }
    .btn-download { background:#229acd; color:white; }
    /* responsive */
    @media (max-width:600px){
      .link-block { flex-direction:column; align-items:flex-start; }
      .button-container { width:100%; justify-content:flex-end; }
      .link-info { max-width:100%; }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <h1 style="margin:0;">mini-projects â€” Files</h1>
    <button id="themeToggle" class="btn" style="margin-left:auto;">...</button>
  </div>
  <div id="linkContainer" class="link-container">Loading files...</div>
  <script>
    const owner = "nathanlobo";
    const repo = "mini-projects";
    const branch = "main";

    const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/`;

    const container = document.getElementById('linkContainer');

    // Helper that fetches the raw file and forces a download (works cross-origin)
    async function downloadFile(rawUrl, filename) {
      try {
        const res = await fetch(rawUrl);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const blob = await res.blob();
        const blobUrl = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = filename || rawUrl.split('/').pop();
        // append to DOM to make click work in some browsers
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        a.remove();
        // Revoke after a short delay so the download has started
        setTimeout(() => URL.revokeObjectURL(blobUrl), 1500);
      } catch (err) {
        console.error('Download failed, opening raw URL instead:', err);
        // fallback: open raw URL in new tab
        window.open(rawUrl, '_blank');
      }
    }

    // Fetch file list from GitHub API (root only). For nested directories extend recursively.
    fetch(apiUrl)
      .then(r => r.json())
      .then(list => {
        if (!Array.isArray(list)) {
          container.innerHTML = '<p>Unable to load files.</p>';
          console.error('Unexpected API response', list);
          return;
        }
        container.innerHTML = '';
        list.forEach(file => {
          // only show files (skip directories). You can optionally recurse into directories.
          if (file.type !== 'file') return;

          const block = document.createElement('div');
          block.className = 'link-block';

          const info = document.createElement('div');
          info.className = 'link-info';

          const title = document.createElement('div');
          title.className = 'link-title';
          title.textContent = file.name;

          // clickable truncated link (opens GitHub file page)
          const urlA = document.createElement('a');
          urlA.className = 'link-url';
          urlA.href = file.html_url;
          urlA.textContent = file.path;
          urlA.target = '_blank';
          urlA.rel = 'noopener noreferrer';

          info.appendChild(title);
          info.appendChild(urlA);

          const btns = document.createElement('div');
          btns.className = 'button-container';

          // View button -> navigate to view.html (store path in localStorage)
          const viewBtn = document.createElement('button');
          viewBtn.className = 'btn btn-view';
          viewBtn.textContent = 'View';
          viewBtn.addEventListener('click', () => {
            localStorage.setItem('filePath', file.path);
            window.location.href = 'view.html';
          });

          // Download button -> use downloadFile helper and raw.githubusercontent URL
          const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${encodeURIComponent(file.path).replace(/%2F/g, '/')}`;
          const downloadBtn = document.createElement('button');
          downloadBtn.className = 'btn btn-download';
          downloadBtn.textContent = 'Download';
          downloadBtn.addEventListener('click', () => downloadFile(rawUrl, file.name));

          btns.appendChild(viewBtn);
          btns.appendChild(downloadBtn);

          block.appendChild(info);
          block.appendChild(btns);
          container.appendChild(block);
        });
      })
      .catch(err => {
        console.error(err);
        container.innerHTML = '<p>Error loading files.</p>';
      });
  </script>
              <script>
  const themeBtn = document.getElementById("themeToggle");
  let hljsTheme = null; // not used on main page but kept for compatibility

  function setTheme(mode) {
    if (mode === "light") {
      document.documentElement.classList.add("light");
      themeBtn.textContent = "Dark";
    } else {
      document.documentElement.classList.remove("light");
      themeBtn.textContent = "Light";
    }
    localStorage.setItem("theme", mode);
  }

  const systemPrefDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  const savedTheme = localStorage.getItem("theme");
  setTheme(savedTheme || (systemPrefDark ? "dark" : "light"));

  themeBtn.addEventListener("click", () => {
    const current = document.documentElement.classList.contains("light") ? "light" : "dark";
    setTheme(current === "light" ? "dark" : "light");
  });
</script>
</body>
</html>