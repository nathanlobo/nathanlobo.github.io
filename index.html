<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CodeStore - Lobo</title>
  <style>
              :root {
  --bg: #0d1117;
  --panel: #0d1117;
  --muted: #8b949e;
  --border: #30363d;
  --accent: #74b5ff;
  --text: #c9d1d9;
}
:root.light {
  --bg: #ffffff;
  --panel: #f6f8fa;
  --muted: #57606a;
  --border: #d0d7de;
  --accent: #0969da;
  --text: #24292f;
}
body { background: var(--bg); color: var(--text); }
.topbar {
  display:flex; align-items:center;
  padding:12px 16px; border-bottom:1px solid var(--border);
  background:var(--panel);
}
.btn {
  background:transparent; border:1px solid transparent;
  color:var(--muted); padding:6px 10px;
  border-radius:6px; cursor:pointer; font-weight:700;
}
.btn:hover { color:var(--accent); background:rgba(255, 11, 11, 0.06); }
              
  body { font-family: Arial, sans-serif; background: var(--bg); color: var(--text); padding:20px; }
  .link-container { display:flex; flex-direction:column; gap:15px; max-width:900px; margin:auto; margin-top:32px; }
    /* MODIFIED: Changed display to block for full-width internal content */
    .link-block { background:#161d80; color:white; padding:12px 16px; border-radius:8px;
                  display:block; }
    /* MODIFIED: Increased max-width to 100% */
    .link-info { display:flex; flex-direction:column; gap:4px; overflow:hidden; max-width:100%; }
    .link-title { font-weight:700; font-size:15px; }
    /* MODIFIED: Removed truncation CSS (white-space: nowrap, text-overflow: ellipsis) */
    .link-url { 
        font-size:13px; 
        color:rgba(255,255,255,0.95); 
        overflow:initial; 
        text-overflow:initial; 
        white-space:normal; /* Allows text to wrap */
        display:block;
        width: 100%;
    }
    /* NEW CLASS: Used in JS to align content and buttons */
    .file-row { 
        display: flex; 
        flex-wrap: wrap; 
        justify-content: space-between; 
        align-items: center; 
        width: 100%; 
        margin-top: 4px;
        gap: 8px; 
    }
    /* MODIFIED: Added flex-shrink: 0 to prevent buttons from shrinking */
    .button-container { display:flex; gap:8px; flex-shrink: 0; }
    .btn { padding:8px 12px; border-radius:5px; border:none; cursor:pointer; font-weight:700; }
    .btn-view { background:#0b66ff; color:white; }
    .btn-output { background:#0b66ff; color:white; }
    .btn-download { background:#0b66ff; color:white; }
    /* responsive */
    @media (max-width:600px){
      .link-block { flex-direction:column; align-items:flex-start; }
      .button-container { width:100%; justify-content:flex-end; }
      .link-info { max-width:100%; }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="tabs-nav">
      <button class="tab-btn active" data-tab="HTML">HTML</button>
      <button class="tab-btn" data-tab="PHP">PHP</button>
      <button class="tab-btn" data-tab="DSC++">DSC++</button>
    </div>
    <button id="themeToggle" class="btn" style="margin-left:auto;">...</button>
  </div>
  <style>
    .tabs-nav {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .tab-btn {
      background: none;
      border: none;
      color: var(--muted);
      font-weight: 700;
      font-size: 16px;
      padding: 6px 18px;
      border-radius: 6px 6px 0 0;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      margin-bottom: -1px;
      border-bottom: 2px solid transparent;
    }
    .tab-btn.active, .tab-btn:hover {
      color: var(--accent);
      background: var(--bg);
      border-bottom: 2px solid var(--accent);
    }
  </style>
  <div id="linkContainer" class="link-container">Loading...</div>
  <script>
    const dscppExpts = [
      {
        name: "Expt 1",
        files: ["DSCpp/expt1/overloading_1a.cpp", 
                "DSCpp/expt1/overloading_1b.cpp",
                "DSCpp/expt1/overloading_1c.cpp",
                "DSCpp/expt1/overloading_1d.cpp"]
      },
      {
        name: "Expt 2",
        files: ["DSCpp/expt2/expt2a.cpp", 
                "DSCpp/expt2/expt2b.cpp",
                "DSCpp/expt2/expt2c.cpp",
                "DSCpp/expt2/expt2d.cpp",
                "DSCpp/expt2/expt2e.cpp"]
      },
      {
        name: "Expt 3",
        files: ["DSCpp/expt3/expt3.1.a.cpp",
                "DSCpp/expt3/expt3.1.b.cpp",
                "DSCpp/expt3/expt3.2.a.cpp",
                "DSCpp/expt3/expt3.2.b.cpp",
                "DSCpp/expt3/expt3.3.a.cpp",
                "DSCpp/expt3/expt3.3.b.cpp",
                "DSCpp/expt3/expt3.4.a.cpp",
                "DSCpp/expt3/expt3.5.a.cpp",
                "DSCpp/expt3/expt3.6.a.cpp",
                "DSCpp/expt3/expt3.7.a.cpp"],
        filedesc:["Expt 3.1a - Single Inheritance in Public Mode",
                  "Expt 3.1b - Public Inheritance Example with Employee and Programmer",
                  "Expt 3.2a - Single Inheritance in Private Mode",
                  "Expt 3.2b - Private Inheritance Example with Bank and Account",
                  "Expt 3.3a - Making Private Members Inheritable Using Protected Access",
                  "Expt 3.3b - Protected Member Inheritance Example with Student and Marks",
                  "Expt 3.4a - Multilevel Inheritance",
                  "Expt 3.5a - Multiple Inheritance",
                  "Expt 3.6a - Hierarchical Inheritance in C++ (University Example)",
                  "Expt 3.7a - Hybrid Inheritance in C++ (University Example)"]
      }
    ];

    const htmlExpts = [
      {
        name: "Expt 1",
        files: ["WD-HTML/Expt-1/expt1a.html",
                "WD-HTML/Expt-1/expt1b.html",
                "WD-HTML/Expt-1/expt1c.html"],
        filedesc:["Expt 1a - Basic HTML Tags",
                  "Expt 1b - All Text Tags",
                  "Expt 1c - All Table Tags (Basic)"]
      },
      {
        name: "Expt 2",
        files: ["WD-HTML/Expt-2/expt2a.html",
                "WD-HTML/Expt-2/expt2b.html"],
        filedesc:["Expt 2a - Class Timetable",
                  "Expt 2b - Table with All Table Tags (Own Idea)"]
      }
    ];
    const owner = "nathanlobo";
    const repo = "CodeStore";
    const branch = "main";
    const container = document.getElementById('linkContainer');
    async function downloadFile(rawUrl, filename) {
      try {
        const res = await fetch(rawUrl);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const blob = await res.blob();
        const blobUrl = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = filename || rawUrl.split('/').pop();
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(() => URL.revokeObjectURL(blobUrl), 1500);
      } catch (err) {
        console.error('Download failed, opening raw URL instead:', err);
        window.open(rawUrl, '_blank');
      }
    }

    // Render experiment cards
    function renderExperiments(expts) {
      if (!Array.isArray(expts) || expts.length === 0) {
        container.innerHTML = '<p>No experiments defined.</p>';
        return;
      }
      container.innerHTML = '';
      expts.forEach((exp, idx) => {
        const block = document.createElement('div');
        block.className = 'link-block';

        const info = document.createElement('div');
        info.className = 'link-info';

        const title = document.createElement('div');
        title.className = 'link-title';
        title.textContent = exp.name || `Experiment ${idx+1}`;

        info.appendChild(title);

        // List files for this experiment
        if (Array.isArray(exp.files) && exp.files.length > 0) {
          exp.files.forEach((filePath, fileIdx) => {
            const fileDiv = document.createElement('div');
            fileDiv.className = 'file-row'; 

            // Use filedesc if available, else fallback to filePath
            const urlA = document.createElement('a');
            urlA.className = 'link-url';
            urlA.href = `https://github.com/${owner}/${repo}/blob/${branch}/${encodeURIComponent(filePath).replace(/%2F/g, '/')}`;
            let desc = (Array.isArray(exp.filedesc) && exp.filedesc[fileIdx]) ? exp.filedesc[fileIdx] : filePath;
            urlA.textContent = desc;
            urlA.target = '_blank';
            urlA.rel = 'noopener noreferrer';

            fileDiv.appendChild(urlA);

            // Button container for Code, Output, Download
            const btnContainer = document.createElement('div');
            btnContainer.className = 'button-container';
            btnContainer.style.gap = '4px';

            // Code button
            const codeBtn = document.createElement('button');
            codeBtn.className = 'btn btn-view';
            codeBtn.textContent = 'Code';
            codeBtn.addEventListener('click', () => {
              localStorage.setItem('filePath', filePath);
              localStorage.setItem('experimentName', exp.name || `Experiment ${idx+1}`);
              window.location.href = 'view.html';
            });


            // Output button (disable for DSC++ tab)
            const outputBtn = document.createElement('button');
            outputBtn.className = 'btn btn-output';
            outputBtn.textContent = 'Output';
            // Disable output button for DSC++ tab
            if (localStorage.getItem('selectedTab') === 'DSC++') {
              outputBtn.disabled = true;
              outputBtn.style.display = 'none'
              outputBtn.style.opacity = '0.5';
              outputBtn.title = 'Output temporarily disabled';
            } else {
              outputBtn.addEventListener('click', () => {
                const outputUrl = `https://nathanlobo.github.io/CodeStore/${filePath}`;
                window.open(outputUrl, '_blank');
              });
            }

            // Download button
            const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${encodeURIComponent(filePath).replace(/%2F/g, '/')}`;
            const downloadBtn = document.createElement('button');
            downloadBtn.className = 'btn btn-download';
            downloadBtn.textContent = 'Download';
            downloadBtn.addEventListener('click', () => downloadFile(rawUrl, filePath.split('/').pop()));

            btnContainer.appendChild(codeBtn);
            btnContainer.appendChild(outputBtn);
            btnContainer.appendChild(downloadBtn);
            fileDiv.appendChild(btnContainer);

            info.appendChild(fileDiv);
          });
        } else {
          const noFiles = document.createElement('div');
          noFiles.textContent = 'No files listed.';
          info.appendChild(noFiles);
        }

        block.appendChild(info);
        container.appendChild(block);
      });
    }

    // Tab switching logic with experiment filtering and persistence
    function activateTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(b => {
        if (b.dataset.tab === tabName) {
          b.classList.add('active');
        } else {
          b.classList.remove('active');
        }
      });
      localStorage.setItem('selectedTab', tabName);
      if (tabName === 'HTML') {
        renderExperiments(htmlExpts);
      } else if (tabName === 'DSC++') {
        renderExperiments(dscppExpts);
      } else {
        container.innerHTML = '<p>No experiments defined for PHP.</p>';
      }
    }

    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        activateTab(this.dataset.tab);
      });
    });

    // On page load, restore last selected tab or default to HTML
    const lastTab = localStorage.getItem('selectedTab') || 'HTML';
    activateTab(lastTab);
  </script>
              <script>
  const themeBtn = document.getElementById("themeToggle");
  let hljsTheme = null; // not used on main page but kept for compatibility

  function setTheme(mode) {
    if (mode === "light") {
      document.documentElement.classList.add("light");
      themeBtn.textContent = "Dark";
    } else {
      document.documentElement.classList.remove("light");
      themeBtn.textContent = "Light";
    }
    localStorage.setItem("theme", mode);
  }

  const systemPrefDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  const savedTheme = localStorage.getItem("theme");
  setTheme(savedTheme || (systemPrefDark ? "dark" : "light"));

  themeBtn.addEventListener("click", () => {
    const current = document.documentElement.classList.contains("light") ? "light" : "dark";
    setTheme(current === "light" ? "dark" : "light");
  });
</script>
</body>
</html>