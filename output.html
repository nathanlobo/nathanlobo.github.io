<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Output</title>
    <style>
        body { 
            font-family: Arial, Helvetica, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column; 
            margin-top: 0;
        }
        .outputFrame {
            height: 100vh;
            width: 100%;
            border: 1px solid black;
            border-radius: 8px;
        }
        .heading {
            background-color: white;
            top: 0; 
            z-index: 999;
            position: sticky;
            align-self: center;
            width: 100%;
            font-size: 16px;
            border: 1px solid black;
            padding: 8px 8px;
            margin-bottom: 6px;
            display:flex;
            border-radius: 0 0 8px 8px;
        }
    </style>
    <script>
      const filePath = localStorage.getItem('filePath');
      const experimentName = localStorage.getItem('experimentName');
      const fileDescription = localStorage.getItem('fileDescription');
      window.location.href = `https://nathanlobo.github.io/CodeStore/${filePath}`; // Replace with your desired URL
      document.title = fileDescription;
      addEventListener("fetch", event => {
  event.respondWith(handleRequest(event.request))
})

async function handleRequest(request) {
  const url = new URL(request.url)
  // point to your byethost subdomain
  url.hostname = "nathanlobo.byethost4.com"   // change this

  // forward method, headers, body
  const originReq = new Request(url.toString(), {
    method: request.method,
    headers: request.headers,
    body: request.body,
    redirect: "follow"
  })

  const originResp = await fetch(originReq)

  // copy headers, then delete the blocking ones
  const newHeaders = new Headers(originResp.headers)
  newHeaders.delete("x-frame-options")
  newHeaders.delete("frame-options")
  newHeaders.delete("content-security-policy")         // remove full CSP
  newHeaders.delete("x-content-security-policy")
  // if you want to allow all frames:
  newHeaders.set("Content-Security-Policy", "frame-ancestors *")

  // return response body as stream for larger pages
  return new Response(originResp.body, {
    status: originResp.status,
    statusText: originResp.statusText,
    headers: newHeaders
  })
}

      // Set title immediately (document.title can be set anytime)
      document.title = fileDescription;
      
      // Wait for DOM to be ready before manipulating elements
      document.addEventListener('DOMContentLoaded', function() {
          document.getElementById('heading').textContent = fileDescription;
          if (filePath) {
              const iframe = document.querySelector('iframe');
              // iframe.src = `https://nathanlobo.github.io/CodeStore/${filePath}`;
              iframe.src = `https://nathanlobo.byethost4.com/expt1_basic_php/basics.php`;
          }
      });
      
  </script>
</head>
<body>
    <div id="heading" class="heading">Title</div>
    <div style="text-align: center; margin: 0 0 16px 0;">
      <div class="screenshot-controls">
        <!-- <button id="screenshot-btn" class="btn" style="background: var(--accent); color: white; padding: 10px 20px;">ðŸ“¸ Generate Code Screenshot</button>
        <div id="bg-dropdown" class="bg-dropdown">
          <div class="bg-option" data-bg="black">
            <div class="bg-preview black"></div>
            <span>Black Background</span>
          </div>
          <div class="bg-option" data-bg="white">
            <div class="bg-preview white"></div>
            <span>White Background</span>
          </div> 
        </div> -->
      </div>
    </div>
    <iframe class="outputFrame" title="Output iframe"></iframe>
</body>

</html>